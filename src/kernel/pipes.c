#include "pipes.h"
#include "vga.h"

// i don't know WHY the heck this is happening but if you change this to the actual array size [100][26]
// specifically changing the x dimension to 26 or even 27, you literally just get a blue screen
// any other value besides the actual width (+-1) of the array works
static const uint8_t pipe[100][30] = {
    { 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8 },
    { 8, 9, 10, 11, 12, 12, 12, 12, 12, 11, 12, 11, 10, 9, 13, 14, 14, 15, 16, 17, 18, 18, 18, 19, 19, 8 },
    { 8, 11, 12, 12, 12, 12, 12, 11, 10, 9, 13, 14, 14, 15, 16, 17, 18, 18, 18, 19, 19, 19, 19, 19, 19, 8 },
    { 8, 11, 12, 12, 12, 12, 12, 11, 10, 9, 13, 14, 14, 15, 16, 17, 18, 18, 18, 19, 19, 19, 19, 19, 19, 8 },
    { 8, 11, 12, 12, 12, 12, 12, 11, 10, 9, 13, 14, 14, 15, 16, 17, 18, 18, 18, 19, 19, 19, 19, 19, 19, 8 },
    { 8, 11, 12, 12, 12, 12, 12, 11, 10, 9, 13, 14, 14, 15, 16, 17, 18, 18, 18, 19, 19, 19, 19, 19, 19, 8 },
    { 8, 11, 12, 12, 12, 12, 12, 11, 10, 9, 13, 14, 14, 15, 16, 17, 18, 18, 18, 19, 19, 19, 19, 19, 19, 8 },
    { 8, 11, 12, 12, 12, 12, 12, 11, 10, 9, 13, 14, 14, 15, 16, 17, 18, 18, 18, 19, 19, 19, 19, 19, 19, 8 },
    { 8, 11, 12, 12, 12, 12, 12, 11, 10, 9, 13, 14, 14, 15, 16, 17, 18, 18, 18, 19, 19, 19, 19, 19, 19, 8 },
    { 8, 11, 12, 12, 12, 12, 12, 11, 10, 9, 13, 14, 14, 15, 16, 17, 18, 18, 18, 19, 19, 19, 19, 19, 19, 8 },
    { 8, 19, 19, 19, 19, 19, 19, 19, 19, 19, 19, 19, 19, 19, 19, 19, 19, 19, 19, 19, 19, 19, 19, 19, 19, 8 },
    { 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8 },
    { 0, 8, 19, 19, 19, 19, 19, 19, 19, 19, 19, 19, 19, 19, 19, 19, 19, 19, 19, 19, 19, 19, 19, 19, 8, 0 },
    { 0, 8, 17, 15, 14, 13, 20, 11, 12, 12, 12, 11, 20, 13, 14, 16, 17, 18, 18, 19, 19, 19, 19, 19, 8, 0 },
    { 0, 8, 21, 16, 14, 13, 20, 11, 12, 12, 12, 22, 9, 13, 14, 16, 21, 18, 18, 19, 19, 19, 19, 19, 8, 0 },
    { 0, 8, 17, 15, 14, 13, 20, 22, 12, 12, 12, 22, 20, 13, 14, 16, 17, 18, 18, 19, 19, 19, 19, 19, 8, 0 },
    { 0, 8, 21, 16, 14, 13, 9, 11, 12, 12, 12, 11, 20, 13, 14, 16, 21, 18, 18, 19, 19, 19, 19, 19, 8, 0 },
    { 0, 8, 17, 16, 14, 13, 20, 11, 12, 12, 12, 22, 9, 13, 14, 16, 17, 18, 18, 19, 19, 19, 19, 19, 8, 0 },
    { 0, 8, 21, 16, 14, 13, 20, 22, 12, 12, 12, 11, 9, 13, 14, 16, 17, 18, 18, 19, 19, 19, 19, 19, 8, 0 },
    { 0, 8, 17, 16, 14, 13, 9, 22, 12, 12, 12, 11, 20, 13, 14, 16, 17, 18, 18, 19, 19, 19, 19, 19, 8, 0 },
    { 0, 8, 17, 16, 14, 13, 9, 11, 12, 12, 12, 22, 20, 13, 14, 16, 21, 18, 18, 19, 19, 19, 19, 19, 8, 0 },
    { 0, 8, 17, 16, 14, 13, 20, 11, 12, 12, 12, 11, 9, 13, 14, 15, 17, 18, 18, 19, 19, 19, 19, 19, 8, 0 },
    { 0, 8, 21, 16, 14, 13, 20, 22, 12, 12, 12, 11, 20, 13, 14, 16, 21, 18, 18, 19, 19, 19, 19, 19, 8, 0 },
    { 0, 8, 17, 16, 14, 13, 9, 11, 12, 12, 12, 11, 9, 13, 14, 16, 17, 18, 18, 19, 19, 19, 19, 19, 8, 0 },
    { 0, 8, 21, 16, 14, 13, 9, 22, 12, 12, 12, 11, 20, 13, 14, 15, 21, 18, 18, 19, 19, 19, 19, 19, 8, 0 },
    { 0, 8, 21, 16, 14, 13, 9, 11, 12, 12, 12, 22, 9, 13, 14, 16, 21, 18, 18, 19, 19, 19, 19, 19, 8, 0 },
    { 0, 8, 21, 15, 14, 13, 9, 11, 12, 12, 12, 11, 20, 13, 14, 16, 21, 18, 18, 19, 19, 19, 19, 19, 8, 0 },
    { 0, 8, 17, 16, 14, 13, 20, 11, 12, 12, 12, 11, 20, 13, 14, 16, 21, 18, 18, 19, 19, 19, 19, 19, 8, 0 },
    { 0, 8, 17, 15, 14, 13, 9, 11, 12, 12, 12, 11, 20, 13, 14, 16, 17, 18, 18, 19, 19, 19, 19, 19, 8, 0 },
    { 0, 8, 21, 16, 14, 13, 9, 11, 12, 12, 12, 11, 9, 13, 14, 16, 21, 18, 18, 19, 19, 19, 19, 19, 8, 0 },
    { 0, 8, 21, 16, 14, 13, 9, 11, 12, 12, 12, 11, 20, 13, 14, 15, 21, 18, 18, 19, 19, 19, 19, 19, 8, 0 },
    { 0, 8, 21, 16, 14, 13, 20, 11, 12, 12, 12, 11, 20, 13, 14, 16, 21, 18, 18, 19, 19, 19, 19, 19, 8, 0 },
    { 0, 8, 17, 16, 14, 13, 20, 22, 12, 12, 12, 11, 9, 13, 14, 16, 17, 18, 18, 19, 19, 19, 19, 19, 8, 0 },
    { 0, 8, 17, 16, 14, 13, 9, 11, 12, 12, 12, 11, 20, 13, 14, 16, 17, 18, 18, 19, 19, 19, 19, 19, 8, 0 },
    { 0, 8, 17, 16, 14, 13, 20, 22, 12, 12, 12, 11, 9, 13, 14, 16, 17, 18, 18, 19, 19, 19, 19, 19, 8, 0 },
    { 0, 8, 17, 15, 14, 13, 9, 22, 12, 12, 12, 11, 20, 13, 14, 16, 21, 18, 18, 19, 19, 19, 19, 19, 8, 0 },
    { 0, 8, 21, 16, 14, 13, 9, 11, 12, 12, 12, 11, 20, 13, 14, 16, 21, 18, 18, 19, 19, 19, 19, 19, 8, 0 },
    { 0, 8, 21, 15, 14, 13, 20, 11, 12, 12, 12, 11, 9, 13, 14, 16, 17, 18, 18, 19, 19, 19, 19, 19, 8, 0 },
    { 0, 8, 21, 15, 14, 13, 20, 22, 12, 12, 12, 22, 20, 13, 14, 16, 21, 18, 18, 19, 19, 19, 19, 19, 8, 0 },
    { 0, 8, 17, 16, 14, 13, 20, 11, 12, 12, 12, 11, 9, 13, 14, 15, 17, 18, 18, 19, 19, 19, 19, 19, 8, 0 },
    { 0, 8, 17, 16, 14, 13, 20, 11, 12, 12, 12, 11, 9, 13, 14, 16, 17, 18, 18, 19, 19, 19, 19, 19, 8, 0 },
    { 0, 8, 17, 16, 14, 13, 9, 11, 12, 12, 12, 11, 20, 13, 14, 15, 17, 18, 18, 19, 19, 19, 19, 19, 8, 0 },
    { 0, 8, 21, 16, 14, 13, 9, 11, 12, 12, 12, 11, 9, 13, 14, 16, 17, 18, 18, 19, 19, 19, 19, 19, 8, 0 },
    { 0, 8, 17, 16, 14, 13, 20, 11, 12, 12, 12, 11, 9, 13, 14, 16, 21, 18, 18, 19, 19, 19, 19, 19, 8, 0 },
    { 0, 8, 21, 16, 14, 13, 9, 11, 12, 12, 12, 11, 9, 13, 14, 16, 17, 18, 18, 19, 19, 19, 19, 19, 8, 0 },
    { 0, 8, 17, 16, 14, 13, 20, 22, 12, 12, 12, 22, 20, 13, 14, 16, 17, 18, 18, 19, 19, 19, 19, 19, 8, 0 },
    { 0, 8, 17, 15, 14, 13, 9, 22, 12, 12, 12, 11, 9, 13, 14, 16, 17, 18, 18, 19, 19, 19, 19, 19, 8, 0 },
    { 0, 8, 21, 16, 14, 13, 9, 22, 12, 12, 12, 22, 9, 13, 14, 16, 21, 18, 18, 19, 19, 19, 19, 19, 8, 0 },
    { 0, 8, 21, 16, 14, 13, 9, 11, 12, 12, 12, 11, 20, 13, 14, 16, 17, 18, 18, 19, 19, 19, 19, 19, 8, 0 },
    { 0, 8, 21, 16, 14, 13, 20, 11, 12, 12, 12, 11, 20, 13, 14, 16, 17, 18, 18, 19, 19, 19, 19, 19, 8, 0 },
    { 0, 8, 21, 16, 14, 13, 20, 11, 12, 12, 12, 11, 20, 13, 14, 16, 21, 18, 18, 19, 19, 19, 19, 19, 8, 0 },
    { 0, 8, 17, 15, 14, 13, 20, 11, 12, 12, 12, 22, 9, 13, 14, 16, 21, 18, 18, 19, 19, 19, 19, 19, 8, 0 },
    { 0, 8, 17, 16, 14, 13, 9, 22, 12, 12, 12, 11, 9, 13, 14, 16, 21, 18, 18, 19, 19, 19, 19, 19, 8, 0 },
    { 0, 8, 21, 16, 14, 13, 20, 22, 12, 12, 12, 11, 9, 13, 14, 16, 17, 18, 18, 19, 19, 19, 19, 19, 8, 0 },
    { 0, 8, 21, 16, 14, 13, 20, 11, 12, 12, 12, 11, 20, 13, 14, 15, 17, 18, 18, 19, 19, 19, 19, 19, 8, 0 },
    { 0, 8, 21, 16, 14, 13, 20, 11, 12, 12, 12, 22, 9, 13, 14, 16, 17, 18, 18, 19, 19, 19, 19, 19, 8, 0 },
    { 0, 8, 17, 16, 14, 13, 20, 22, 12, 12, 12, 11, 9, 13, 14, 16, 17, 18, 18, 19, 19, 19, 19, 19, 8, 0 },
    { 0, 8, 17, 16, 14, 13, 9, 11, 12, 12, 12, 22, 9, 13, 14, 16, 17, 18, 18, 19, 19, 19, 19, 19, 8, 0 },
    { 0, 8, 17, 16, 14, 13, 20, 11, 12, 12, 12, 11, 9, 13, 14, 16, 17, 18, 18, 19, 19, 19, 19, 19, 8, 0 },
    { 0, 8, 17, 16, 14, 13, 20, 11, 12, 12, 12, 11, 9, 13, 14, 16, 17, 18, 18, 19, 19, 19, 19, 19, 8, 0 },
    { 0, 8, 21, 16, 14, 13, 9, 11, 12, 12, 12, 11, 20, 13, 14, 16, 17, 18, 18, 19, 19, 19, 19, 19, 8, 0 },
    { 0, 8, 21, 16, 14, 13, 9, 11, 12, 12, 12, 22, 9, 13, 14, 16, 21, 18, 18, 19, 19, 19, 19, 19, 8, 0 },
    { 0, 8, 17, 16, 14, 13, 20, 22, 12, 12, 12, 11, 20, 13, 14, 16, 17, 18, 18, 19, 19, 19, 19, 19, 8, 0 },
    { 0, 8, 17, 16, 14, 13, 9, 11, 12, 12, 12, 11, 9, 13, 14, 16, 21, 18, 18, 19, 19, 19, 19, 19, 8, 0 },
    { 0, 8, 17, 16, 14, 13, 20, 11, 12, 12, 12, 11, 20, 13, 14, 16, 21, 18, 18, 19, 19, 19, 19, 19, 8, 0 },
    { 0, 8, 21, 16, 14, 13, 9, 22, 12, 12, 12, 11, 9, 13, 14, 15, 17, 18, 18, 19, 19, 19, 19, 19, 8, 0 },
    { 0, 8, 17, 16, 14, 13, 20, 11, 12, 12, 12, 22, 20, 13, 14, 16, 17, 18, 18, 19, 19, 19, 19, 19, 8, 0 },
    { 0, 8, 17, 16, 14, 13, 9, 11, 12, 12, 12, 11, 9, 13, 14, 16, 17, 18, 18, 19, 19, 19, 19, 19, 8, 0 },
    { 0, 8, 17, 16, 14, 13, 20, 22, 12, 12, 12, 11, 20, 13, 14, 16, 17, 18, 18, 19, 19, 19, 19, 19, 8, 0 },
    { 0, 8, 21, 16, 14, 13, 20, 11, 12, 12, 12, 11, 9, 13, 14, 16, 21, 18, 18, 19, 19, 19, 19, 19, 8, 0 },
    { 0, 8, 21, 16, 14, 13, 9, 11, 12, 12, 12, 11, 9, 13, 14, 16, 17, 18, 18, 19, 19, 19, 19, 19, 8, 0 },
    { 0, 8, 21, 16, 14, 13, 9, 11, 12, 12, 12, 22, 20, 13, 14, 16, 17, 18, 18, 19, 19, 19, 19, 19, 8, 0 },
    { 0, 8, 21, 16, 14, 13, 20, 11, 12, 12, 12, 11, 20, 13, 14, 16, 21, 18, 18, 19, 19, 19, 19, 19, 8, 0 },
    { 0, 8, 17, 16, 14, 13, 9, 11, 12, 12, 12, 11, 9, 13, 14, 16, 17, 18, 18, 19, 19, 19, 19, 19, 8, 0 },
    { 0, 8, 17, 15, 14, 13, 9, 11, 12, 12, 12, 11, 20, 13, 14, 16, 17, 18, 18, 19, 19, 19, 19, 19, 8, 0 },
    { 0, 8, 17, 16, 14, 13, 20, 11, 12, 12, 12, 11, 20, 13, 14, 16, 17, 18, 18, 19, 19, 19, 19, 19, 8, 0 },
    { 0, 8, 17, 16, 14, 13, 9, 11, 12, 12, 12, 11, 20, 13, 14, 16, 17, 18, 18, 19, 19, 19, 19, 19, 8, 0 },
    { 0, 8, 17, 15, 14, 13, 20, 11, 12, 12, 12, 22, 9, 13, 14, 16, 17, 18, 18, 19, 19, 19, 19, 19, 8, 0 },
    { 0, 8, 17, 16, 14, 13, 9, 22, 12, 12, 12, 11, 20, 13, 14, 16, 17, 18, 18, 19, 19, 19, 19, 19, 8, 0 },
    { 0, 8, 17, 16, 14, 13, 20, 11, 12, 12, 12, 11, 20, 13, 14, 15, 21, 18, 18, 19, 19, 19, 19, 19, 8, 0 },
    { 0, 8, 17, 16, 14, 13, 20, 22, 12, 12, 12, 11, 9, 13, 14, 16, 17, 18, 18, 19, 19, 19, 19, 19, 8, 0 },
    { 0, 8, 21, 16, 14, 13, 20, 11, 12, 12, 12, 11, 20, 13, 14, 16, 17, 18, 18, 19, 19, 19, 19, 19, 8, 0 },
    { 0, 8, 21, 16, 14, 13, 20, 11, 12, 12, 12, 11, 20, 13, 14, 16, 21, 18, 18, 19, 19, 19, 19, 19, 8, 0 },
    { 0, 8, 17, 15, 14, 13, 20, 11, 12, 12, 12, 22, 9, 13, 14, 16, 21, 18, 18, 19, 19, 19, 19, 19, 8, 0 },
    { 0, 8, 17, 16, 14, 13, 9, 22, 12, 12, 12, 11, 9, 13, 14, 16, 21, 18, 18, 19, 19, 19, 19, 19, 8, 0 },
    { 0, 8, 21, 16, 14, 13, 20, 22, 12, 12, 12, 11, 9, 13, 14, 16, 17, 18, 18, 19, 19, 19, 19, 19, 8, 0 },
    { 0, 8, 21, 16, 14, 13, 20, 11, 12, 12, 12, 11, 20, 13, 14, 15, 17, 18, 18, 19, 19, 19, 19, 19, 8, 0 },
    { 0, 8, 21, 16, 14, 13, 20, 11, 12, 12, 12, 22, 9, 13, 14, 16, 17, 18, 18, 19, 19, 19, 19, 19, 8, 0 },
    { 0, 8, 17, 16, 14, 13, 20, 22, 12, 12, 12, 11, 9, 13, 14, 16, 17, 18, 18, 19, 19, 19, 19, 19, 8, 0 },
    { 0, 8, 17, 16, 14, 13, 9, 11, 12, 12, 12, 22, 9, 13, 14, 16, 17, 18, 18, 19, 19, 19, 19, 19, 8, 0 },
    { 0, 8, 17, 16, 14, 13, 20, 11, 12, 12, 12, 11, 9, 13, 14, 16, 17, 18, 18, 19, 19, 19, 19, 19, 8, 0 },
    { 0, 8, 21, 16, 14, 13, 20, 11, 12, 12, 12, 11, 20, 13, 14, 16, 17, 18, 18, 19, 19, 19, 19, 19, 8, 0 },
    { 0, 8, 21, 16, 14, 13, 20, 11, 12, 12, 12, 11, 20, 13, 14, 16, 21, 18, 18, 19, 19, 19, 19, 19, 8, 0 },
    { 0, 8, 17, 15, 14, 13, 20, 11, 12, 12, 12, 22, 9, 13, 14, 16, 21, 18, 18, 19, 19, 19, 19, 19, 8, 0 },
    { 0, 8, 17, 16, 14, 13, 9, 22, 12, 12, 12, 11, 9, 13, 14, 16, 21, 18, 18, 19, 19, 19, 19, 19, 8, 0 },
    { 0, 8, 21, 16, 14, 13, 20, 22, 12, 12, 12, 11, 9, 13, 14, 16, 17, 18, 18, 19, 19, 19, 19, 19, 8, 0 },
    { 0, 8, 21, 16, 14, 13, 20, 11, 12, 12, 12, 11, 20, 13, 14, 15, 17, 18, 18, 19, 19, 19, 19, 19, 8, 0 },
    { 0, 8, 21, 16, 14, 13, 20, 11, 12, 12, 12, 22, 9, 13, 14, 16, 17, 18, 18, 19, 19, 19, 19, 19, 8, 0 },
    { 0, 8, 17, 16, 14, 13, 20, 22, 12, 12, 12, 11, 9, 13, 14, 16, 17, 18, 18, 19, 19, 19, 19, 19, 8, 0 },
    { 0, 8, 17, 16, 14, 13, 9, 11, 12, 12, 12, 22, 9, 13, 14, 16, 17, 18, 18, 19, 19, 19, 19, 19, 8, 0 }
};

static struct Pipes PIPES[5];

void pipes_init() {
    for (int i = 0; i < sizeof(PIPES) / sizeof(PIPES[0]); i++) {
        PIPES[i] = (struct Pipes) {
            .x = i * 70,
            .offset = rand(i*1234) % 75
        };
    }
}

void pipes_draw(uint64_t tick) {
    for (int i = 0; i < sizeof(PIPES) / sizeof(PIPES[0]); i++) { // num pipes
        for (int j = 0; j < 2; j++) { // top and bottom
            for (int y = 0; y < 100; y++) {
                for (int x = 0; x < 26; x++) {
                    putpixel(pipe[j ? y : 99 - y][x], PIPES[i].x + x, j ? 180 + y - PIPES[i].offset : y - PIPES[i].offset);
                }
            }
        }


        if (PIPES[i].x >= -26) PIPES[i].x -= 2; // loop back over screen
        else {
            PIPES[i].offset = rand(i*1234) % 75;
            PIPES[i].x = VGA_WIDTH;
        }
    }
}
